<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semiglutide Simulator</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Semiglutide Sim">
    <meta name="theme-color" content="#667eea">

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <script src="add-to-homescreen.js"></script>
    <script>
        // Global simulator instance
        let simulator;

        // Global functions for button clicks - defined at top level for immediate availability
        function toggleSettings() {
            if (!simulator) return;
            const modal = document.getElementById('settingsModal');
            modal.classList.toggle('hidden');

            if (!modal.classList.contains('hidden')) {
                // Load current values
                document.getElementById('startingDose').value = simulator.dose;
                document.getElementById('currentWeek').value = simulator.week;
                document.getElementById('weightGoal').value = simulator.weightGoal;
                document.getElementById('currentWeightLoss').value = simulator.weightLoss.toFixed(1);
                document.getElementById('enableTimeControls').checked = simulator.enableTimeControls;

                // Load supplements list
                simulator.updateSupplementsList();
            }
        }

        function eatMeal() {
            if (!simulator) return;
            simulator.eatMeal();
        }


        function advanceTime(hours) {
            if (!simulator) return;
            simulator.advanceTime(hours);
        }

        function clearMessages() {
            if (!simulator) return;
            document.getElementById('messageContainer').innerHTML = '';
            simulator.logEntries = [];
            simulator.saveToLocalStorage();
            simulator.addLogEntry("Message history cleared");
        }

        function clearMealHistory() {
            if (!simulator) return;
            document.getElementById('mealHistory').innerHTML = '';
            simulator.mealHistory = [];
            simulator.saveToLocalStorage();
            simulator.addLogEntry("Meal history cleared");
        }

        function saveSettings() {
            if (!simulator) return;
            const dose = parseFloat(document.getElementById('startingDose').value);
            const week = parseInt(document.getElementById('currentWeek').value);
            const weightGoal = parseInt(document.getElementById('weightGoal').value);
            const weightLoss = parseFloat(document.getElementById('currentWeightLoss').value);
            const enableTimeControls = document.getElementById('enableTimeControls').checked;

            if (isNaN(dose) || isNaN(week) || isNaN(weightGoal) || isNaN(weightLoss)) {
                if (simulator) simulator.showNotification("Please enter valid values");
                return;
            }

            simulator.dose = dose;
            simulator.week = week;
            simulator.weightGoal = weightGoal;
            simulator.weightLoss = weightLoss;
            simulator.enableTimeControls = enableTimeControls;
            simulator.saveToLocalStorage();
            simulator.updateDisplay();
            updateSettingsDisplay();
            updateTimeControlsVisibility();

            simulator.addLogEntry("Settings updated", "success");
            simulator.showNotification("Settings saved successfully");

            toggleSettings();
        }

        function updateTimeControlsVisibility() {
            const timeControlsSection = document.getElementById('timeControlsSection');
            if (simulator && simulator.enableTimeControls) {
                timeControlsSection.style.display = 'block';
            } else {
                timeControlsSection.style.display = 'none';
            }
        }

        function updateSettingsDisplay() {
            if (!simulator) return;
            // Update weight progress display in the main card
            document.getElementById('weightProgress').textContent = `-${simulator.weightLoss.toFixed(1)}kg`;
            document.getElementById('weightGoalDisplay').textContent = `${simulator.weightLoss.toFixed(1)}kg / ${simulator.weightGoal}kg Goal`;
        }

        function addSupplement() {
            if (!simulator) {
                alert("App is still loading. Please wait a moment and try again.");
                return;
            }

            const nameInput = document.getElementById('supplementName');
            const timeInput = document.getElementById('supplementTime');

            if (!nameInput || !timeInput) {
                simulator.showNotification("Input fields not found");
                return;
            }

            const name = nameInput.value.trim();
            const time = timeInput.value;

            if (!name || !time) {
                simulator.showNotification("Please enter both supplement name and time");
                return;
            }

            simulator.supplements.push({ name, time });
            simulator.updateSupplementsList();
            simulator.saveToLocalStorage();

            // Clear inputs
            nameInput.value = '';
            timeInput.value = '';

            simulator.showNotification(`Added ${name} at ${time}`);

            // Keep modal open for adding more supplements
        }

        function removeSupplement(index) {
            if (!simulator) return;
            const supplement = simulator.supplements[index];
            simulator.supplements.splice(index, 1);
            simulator.updateSupplementsList();
            simulator.saveToLocalStorage();
            simulator.showNotification(`Removed ${supplement.name}`);
        }

        function toggleDarkMode() {
            const html = document.documentElement;
            const isDark = html.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark ? 'true' : 'false');

            // Update toggle button icon
            const toggleBtn = document.getElementById('darkModeToggle');
            const svg = toggleBtn.querySelector('svg');
            if (isDark) {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>';
            } else {
                svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>';
            }
        }

        function loadDarkModePreference() {
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'true') {
                document.documentElement.classList.add('dark');
                // Update icon
                const toggleBtn = document.getElementById('darkModeToggle');
                if (toggleBtn) {
                    const svg = toggleBtn.querySelector('svg');
                    svg.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>';
                }
            }
        }

        class SemiglutideSimulator {
            constructor() {
                // Load from local storage or initialize defaults
                this.loadFromLocalStorage();

                // Initialize if no data exists
                if (!this.currentTime) {
                    this.currentTime = new Date();
                    this.currentTime.setHours(8, 0, 0); // Start at 8 AM
                    this.week = 1;
                    this.dose = 0.25;
                    this.weightLoss = 0;
                    this.weightGoal = 5;
                    this.treatmentDay = 1;
                    this.lastMealTime = null;
                    this.cravings = [];
                    this.mealHistory = [];
                    this.enableTimeControls = false;
                    this.supplements = [];
                    this.initializeCravings();
                }

                this.hungerLevel = 25;
                this.appetite = "Low";
                this.energy = "Stable";
                this.nausea = "None";
                this.cravingsIntensity = 0;

                this.updateDisplay();
                this.startSimulation();
                updateTimeControlsVisibility(); // Update time controls visibility on init

                // Add login chain of thoughts
                this.addLoginThoughts();
                this.addLogEntry("System initialized - Welcome to Semiglutide Simulator");
                this.addLogEntry(`Week ${this.week} treatment started - ${this.dose}mg dose active`);
            }

            loadFromLocalStorage() {
                const savedData = localStorage.getItem('semiglutideSimulator');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    this.currentTime = new Date(data.currentTime);
                    this.week = data.week || 1;
                    this.dose = data.dose || 0.25;
                    this.weightLoss = data.weightLoss || 0;
                    this.weightGoal = data.weightGoal || 5;
                    this.treatmentDay = data.treatmentDay || 1;
                    this.lastMealTime = data.lastMealTime ? new Date(data.lastMealTime) : null;
                    this.cravings = data.cravings || [];
                    this.mealHistory = data.mealHistory || [];
                    this.logEntries = data.logEntries || [];
                    this.enableTimeControls = data.enableTimeControls || false;
                    this.supplements = data.supplements || [];
                }
            }

            saveToLocalStorage() {
                const data = {
                    currentTime: this.currentTime,
                    week: this.week,
                    dose: this.dose,
                    weightLoss: this.weightLoss,
                    weightGoal: this.weightGoal,
                    treatmentDay: this.treatmentDay,
                    lastMealTime: this.lastMealTime,
                    cravings: this.cravings,
                    mealHistory: this.mealHistory,
                    logEntries: this.logEntries,
                    enableTimeControls: this.enableTimeControls,
                    supplements: this.supplements
                };
                localStorage.setItem('semiglutideSimulator', JSON.stringify(data));
            }

            initializeCravings() {
                this.cravings = [
                    { food: "Something crunchy", intensity: 0.3, time: "afternoon" },
                    { food: "Sweet snack", intensity: 0.5, time: "evening" },
                    { food: "Comfort food", intensity: 0.4, time: "night" },
                    { food: "Salty chips", intensity: 0.6, time: "midday" },
                    { food: "Chocolate", intensity: 0.7, time: "evening" },
                    { food: "Pasta", intensity: 0.5, time: "lunch" }
                ];
            }

            startSimulation() {
                // Update time every second
                setInterval(() => {
                    this.updateDisplay();
                }, 1000);

                // Auto-save every 30 seconds
                setInterval(() => {
                    this.saveToLocalStorage();
                }, 30000);

                // Simulate effects every 10 seconds (slower, more realistic)
                setInterval(() => {
                    this.simulateEffects();
                }, 10000);

                // Restore log entries from local storage
                this.restoreLogEntries();
                this.restoreMealHistory();

                // Start supplement notifications
                this.startSupplementNotifications();
            }

            restoreLogEntries() {
                if (this.logEntries && this.logEntries.length > 0) {
                    const container = document.getElementById('messageContainer');
                    this.logEntries.forEach(entry => {
                        const entryElement = document.createElement('div');
                        entryElement.className = `message-bubble p-2 rounded-lg ${this.getMessageClass(entry.type)}`;
                        entryElement.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <p class="text-xs dark:text-gray-200">${entry.message}</p>
                                </div>
                                <span class="text-xs text-gray-400 dark:text-gray-500 ml-2 whitespace-nowrap">${entry.time}</span>
                            </div>
                        `;
                        container.appendChild(entryElement);
                    });
                    container.scrollTop = container.scrollHeight;
                }
            }

            restoreMealHistory() {
                if (this.mealHistory && this.mealHistory.length > 0) {
                    const container = document.getElementById('mealHistory');
                    this.mealHistory.forEach(meal => {
                        const mealElement = document.createElement('div');
                        mealElement.className = 'flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-md text-sm';
                        mealElement.innerHTML = `
                            <span class="dark:text-gray-200">${meal.time} - ${meal.type}</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">${meal.hungerBefore}% â†’ ${meal.hungerAfter}%</span>
                        `;
                        container.appendChild(mealElement);
                    });
                }
            }

            simulateEffects() {
                const hour = this.currentTime.getHours();
                const hoursSinceMeal = this.getHoursSinceLastMeal();

                // Much more realistic hunger progression - very slow changes
                // GLP-1 medications significantly reduce appetite throughout the day
                if (hour >= 7 && hour <= 9) {
                    // Morning - reduced appetite due to medication
                    this.hungerLevel = Math.max(8, this.hungerLevel - 0.2);
                    this.appetite = "Very Low";
                } else if (hour >= 12 && hour <= 14) {
                    // Midday - slight hunger, but still suppressed
                    this.hungerLevel = Math.min(35, this.hungerLevel + 0.3);
                    this.appetite = "Low";
                } else if (hour >= 18 && hour <= 20) {
                    // Evening - moderate hunger, but still less than normal
                    this.hungerLevel = Math.min(45, this.hungerLevel + 0.4);
                    this.appetite = "Moderate";
                } else {
                    // Other times - minimal hunger due to medication
                    this.hungerLevel = Math.max(12, this.hungerLevel - 0.1);
                    this.appetite = "Low";
                }

                // Additional hunger suppression based on time since last meal
                // GLP-1 effect: reduced hunger even hours after eating
                if (hoursSinceMeal < 2) {
                    // Recently ate - very low hunger
                    this.hungerLevel = Math.max(5, this.hungerLevel - 1);
                } else if (hoursSinceMeal < 4) {
                    // 2-4 hours after meal - still suppressed
                    this.hungerLevel = Math.max(8, this.hungerLevel - 0.5);
                } else if (hoursSinceMeal > 6) {
                    // More than 6 hours - gradual increase but still suppressed
                    this.hungerLevel = Math.min(50, this.hungerLevel + 0.2);
                }

                // Energy patterns - more realistic
                if (hour >= 14 && hour <= 16 && this.week <= 2) {
                    if (Math.random() < 0.15) { // Reduced chance
                        this.energy = "Low";
                        this.addLogEntry("Energy crash detected - normal for week " + this.week, "warning");
                    }
                } else if (this.lastMealTime && this.getHoursSinceLastMeal() > 6) { // Longer before decline
                    this.energy = "Declining";
                } else {
                    this.energy = "Stable";
                }

                // Nausea patterns (common side effect) - less frequent
                if (this.week <= 2 && (hour >= 10 && hour <= 12)) {
                    if (Math.random() < 0.2) { // Reduced chance
                        this.nausea = "Mild";
                    }
                } else if (this.week > 2) {
                    this.nausea = "None";
                }

                // Update cravings intensity
                this.updateCravingsIntensity();

                this.updateDisplay();
                this.saveToLocalStorage();
            }

            updateCravingsIntensity() {
                const hour = this.currentTime.getHours();
                const hoursSinceMeal = this.getHoursSinceLastMeal();

                // Base cravings intensity based on time and medication effectiveness
                let baseIntensity = 0.2; // Reduced due to medication

                // Time-based cravings (evening/night are typically higher)
                if (hour >= 18 && hour <= 22) {
                    baseIntensity += 0.3;
                } else if (hour >= 14 && hour <= 17) {
                    baseIntensity += 0.2;
                }

                // Hunger-based cravings
                if (this.hungerLevel > 40) {
                    baseIntensity += 0.2;
                }

                // Time since last meal
                if (hoursSinceMeal > 8) {
                    baseIntensity += 0.3;
                } else if (hoursSinceMeal > 4) {
                    baseIntensity += 0.1;
                }

                // Medication effectiveness (improves over time)
                baseIntensity *= (1 - (this.week * 0.08)); // Gradually reduce cravings

                this.cravingsIntensity = Math.max(0, Math.min(1, baseIntensity));
            }

            getHoursSinceLastMeal() {
                if (!this.lastMealTime) return 999;
                return (this.currentTime - this.lastMealTime) / (1000 * 60 * 60);
            }

            eatMeal() {
                const hungerBefore = this.hungerLevel;
                this.lastMealTime = new Date(this.currentTime);

                // More realistic hunger reduction
                this.hungerLevel = Math.max(5, this.hungerLevel - 15); // Less dramatic reduction

                // Add to meal history
                const mealTime = this.currentTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                this.mealHistory.push({
                    time: mealTime,
                    type: "Meal",
                    hungerBefore: hungerBefore.toFixed(0),
                    hungerAfter: this.hungerLevel.toFixed(0)
                });

                // Update meal history display
                this.updateMealHistory();

                // Simulate post-meal effects
                if (this.week <= 2 && Math.random() < 0.3) { // Reduced chance
                    this.nausea = "Mild";
                    this.addLogEntry("Post-meal nausea - eating smaller portions helps", "warning");
                } else {
                    this.addLogEntry("Meal consumed - feeling satisfied with smaller portion", "success");
                }

                // Early satiety effect
                setTimeout(() => {
                    this.addLogEntry("GLP-1 effect: Feeling full faster than usual");
                }, 2000);

                this.updateDisplay();
                this.saveToLocalStorage();
            }

            updateMealHistory() {
                const container = document.getElementById('mealHistory');
                container.innerHTML = '';

                // Show last 5 meals
                const recentMeals = this.mealHistory.slice(-5);
                recentMeals.forEach(meal => {
                    const mealElement = document.createElement('div');
                    mealElement.className = 'flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-md text-sm';
                    mealElement.innerHTML = `
                        <span class="dark:text-gray-200">${meal.time} - ${meal.type}</span>
                        <span class="text-xs text-gray-500 dark:text-gray-400">${meal.hungerBefore}% â†’ ${meal.hungerAfter}%</span>
                    `;
                    container.appendChild(mealElement);
                });
            }

            checkCravings() {
                const craving = this.cravings[Math.floor(Math.random() * this.cravings.length)];
                const intensity = craving.intensity * (1 - (this.week * 0.1)); // Cravings reduce over time

                if (intensity > 0.3) {
                    this.addLogEntry(`Craving detected: ${craving.food} (intensity: ${Math.round(intensity * 100)}%)`, "warning");
                    this.showNotification("Craving managed - medication working!");
                } else {
                    this.addLogEntry("No significant cravings - appetite suppression active", "success");
                }
            }

            advanceTime(hours) {
                this.currentTime.setHours(this.currentTime.getHours() + hours);

                // Check for dose time (weekly)
                if (this.currentTime.getDay() === 1 && this.currentTime.getHours() === 8) {
                    this.administerDose();
                }

                this.treatmentDay++;
                this.simulateEffects();
                this.updateDisplay();
                this.saveToLocalStorage();
            }

            administerDose() {
                this.week++;
                this.treatmentDay = 1;

                // Dose escalation pattern
                if (this.week <= 4) {
                    this.dose = 0.25;
                } else if (this.week <= 8) {
                    this.dose = 0.5;
                } else if (this.week <= 12) {
                    this.dose = 1.0;
                } else {
                    this.dose = 2.0;
                }

                this.addLogEntry(`Week ${this.week} dose administered: ${this.dose}mg`, "important");
                this.showNotification(`Dose administered: ${this.dose}mg`);

                // Side effects more likely after dose increase
                if (this.week === 5 || this.week === 9 || this.week === 13) {
                    this.nausea = "Moderate";
                    this.addLogEntry("Dose increased - monitor for side effects", "danger");
                }
            }

            addLoginThoughts() {
                const loginThoughts = [
                    "Welcome back! Let's track your semiglutide journey today.",
                    "Remember: consistency is key to successful weight management.",
                    "Your body is adapting to the medication - stay patient and consistent.",
                    "Each small step forward counts towards your health goals.",
                    "Stay hydrated and listen to your body's signals.",
                    "Progress takes time - celebrate the small victories.",
                    "You're taking control of your health - that's powerful!",
                    "Every day is a new opportunity to build healthy habits.",
                    "Your commitment to this journey is inspiring.",
                    "Remember why you started - your future self will thank you."
                ];

                const randomThought = loginThoughts[Math.floor(Math.random() * loginThoughts.length)];
                this.addLogEntry(randomThought, "important");
            }

            updateTreatmentDots() {
                const dotsContainer = document.getElementById('treatmentDots');
                dotsContainer.innerHTML = '';

                for (let i = 1; i <= 12; i++) {
                    const dot = document.createElement('div');
                    dot.className = `w-1 h-2 rounded-sm transition-all duration-300 ${
                        i <= this.week
                            ? 'bg-purple-500 animate-pulse'
                            : 'bg-gray-300'
                    }`;
                    dotsContainer.appendChild(dot);
                }
            }

            updateStatFormatting() {
                // Appetite formatting
                const appetiteElement = document.getElementById('appetiteLevel');
                let appetiteColor = 'text-gray-700';
                let appetiteAnimation = '';

                if (this.appetite === 'Very Low') {
                    appetiteColor = 'text-green-600';
                    appetiteAnimation = 'animate-pulse';
                } else if (this.appetite === 'Low') {
                    appetiteColor = 'text-blue-600';
                } else if (this.appetite === 'Moderate') {
                    appetiteColor = 'text-orange-600';
                    appetiteAnimation = 'animate-bounce';
                }

                appetiteElement.className = `text-lg font-bold ${appetiteColor} ${appetiteAnimation}`;

                // Energy formatting
                const energyElement = document.getElementById('energyLevel');
                let energyColor = 'text-gray-700';
                let energyAnimation = '';

                if (this.energy === 'Stable') {
                    energyColor = 'text-green-600';
                } else if (this.energy === 'Declining') {
                    energyColor = 'text-yellow-600';
                    energyAnimation = 'animate-pulse';
                } else if (this.energy === 'Low') {
                    energyColor = 'text-red-600';
                    energyAnimation = 'animate-bounce';
                }

                energyElement.className = `text-lg font-bold ${energyColor} ${energyAnimation}`;

                // Nausea formatting
                const nauseaElement = document.getElementById('nauseaLevel');
                let nauseaColor = 'text-gray-700';
                let nauseaAnimation = '';

                if (this.nausea === 'None') {
                    nauseaColor = 'text-green-600';
                } else if (this.nausea === 'Mild') {
                    nauseaColor = 'text-yellow-600';
                    nauseaAnimation = 'animate-pulse';
                } else if (this.nausea === 'Moderate') {
                    nauseaColor = 'text-red-600';
                    nauseaAnimation = 'animate-bounce';
                }

                nauseaElement.className = `text-lg font-bold ${nauseaColor} ${nauseaAnimation}`;

                // Cravings formatting
                const cravingsElement = document.getElementById('cravingsLevel');
                const cravingsEmoji = document.getElementById('cravingsEmoji');
                if (cravingsElement && cravingsEmoji) {
                    const cravingsIntensity = Math.round(this.cravingsIntensity * 100);
                    let cravingsColor = 'text-gray-700';
                    let emoji = 'ðŸª';

                    if (cravingsIntensity <= 20) {
                        cravingsColor = 'text-green-600';
                        emoji = 'ðŸ˜Œ';
                    } else if (cravingsIntensity <= 50) {
                        cravingsColor = 'text-yellow-600';
                        emoji = 'ðŸ¤”';
                    } else if (cravingsIntensity <= 80) {
                        cravingsColor = 'text-orange-600';
                        emoji = 'ðŸ˜©';
                    } else {
                        cravingsColor = 'text-red-600';
                        emoji = 'ðŸ˜±';
                    }

                    cravingsElement.className = `text-lg font-bold ${cravingsColor}`;
                    cravingsElement.textContent = `${cravingsIntensity}%`;
                    cravingsEmoji.textContent = emoji;
                }
            }

            updateDisplay() {
                // Check if DOM elements exist before updating
                const currentDateTime = document.getElementById('currentDateTime');
                if (currentDateTime) {
                    const now = new Date();
                    currentDateTime.textContent = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
                }

                // Update week and dose
                const currentWeekDisplay = document.getElementById('currentWeekDisplay');
                if (currentWeekDisplay) currentWeekDisplay.textContent = this.week;

                const doseDisplay = document.getElementById('doseDisplay');
                if (doseDisplay) doseDisplay.textContent = `${this.dose}mg`;

                const treatmentStatus = document.getElementById('treatmentStatus');
                if (treatmentStatus) treatmentStatus.textContent = `Week ${this.week}/12`;

                // Update weight progress
                const weightProgress = document.getElementById('weightProgress');
                if (weightProgress) weightProgress.textContent = `-${this.weightLoss.toFixed(1)}kg`;

                const weightGoalDisplay = document.getElementById('weightGoalDisplay');
                if (weightGoalDisplay) weightGoalDisplay.textContent = `${this.weightLoss.toFixed(1)}kg / ${this.weightGoal}kg Goal`;

                // Update stats
                const appetiteLevel = document.getElementById('appetiteLevel');
                if (appetiteLevel) appetiteLevel.textContent = this.appetite;

                const energyLevel = document.getElementById('energyLevel');
                if (energyLevel) energyLevel.textContent = this.energy;

                const nauseaLevel = document.getElementById('nauseaLevel');
                if (nauseaLevel) nauseaLevel.textContent = this.nausea;

                // Update hunger visualization
                this.updateHungerVisualization();

                // Update treatment dots
                this.updateTreatmentDots();

                // Update conditional formatting for stats
                this.updateStatFormatting();
            }

            updateHungerVisualization() {
                const hungerLevel = this.hungerLevel;
                const hungerContainer = document.getElementById('hungerVisualization');
                const hungerText = document.getElementById('hungerStatus');

                // Clear previous content
                hungerContainer.innerHTML = '';

                // Create modern hunger visualization
                const segments = 10;
                const filledSegments = Math.round((hungerLevel / 100) * segments);

                for (let i = 0; i < segments; i++) {
                    const segment = document.createElement('div');
                    const isFilled = i < filledSegments;

                    segment.className = `flex-1 h-2 rounded-full mx-0.5 transition-all duration-500 ${
                        isFilled
                            ? hungerLevel <= 25 ? 'bg-green-400 animate-pulse' :
                              hungerLevel <= 50 ? 'bg-blue-400' :
                              hungerLevel <= 75 ? 'bg-yellow-400 animate-pulse' :
                              'bg-red-400 animate-ping'
                            : 'bg-gray-200'
                    }`;

                    hungerContainer.appendChild(segment);
                }

                // Update hunger status text
                let hungerTextContent = "";
                if (hungerLevel <= 20) hungerTextContent = "Very Satisfied";
                else if (hungerLevel <= 40) hungerTextContent = "Satisfied";
                else if (hungerLevel <= 60) hungerTextContent = "Slightly Hungry";
                else if (hungerLevel <= 80) hungerTextContent = "Hungry";
                else hungerTextContent = "Very Hungry";

                hungerText.textContent = `${hungerTextContent} (${hungerLevel.toFixed(0)}%)`;
            }

            addLogEntry(message, type = "info") {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

                const entry = {
                    message: message,
                    type: type,
                    time: timeString
                };

                // Add to log entries array for persistence
                if (!this.logEntries) this.logEntries = [];
                this.logEntries.push(entry);

                // Add to display
                const container = document.getElementById('messageContainer');
                const entryElement = document.createElement('div');
                entryElement.className = `message-bubble p-2 rounded-lg ${this.getMessageClass(type)}`;
                entryElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="text-xs dark:text-gray-200">${message}</p>
                        </div>
                        <span class="text-xs text-gray-400 dark:text-gray-500 ml-2 whitespace-nowrap">${timeString}</span>
                    </div>
                `;

                container.appendChild(entryElement);
                container.scrollTop = container.scrollHeight;

                // Save to local storage
                this.saveToLocalStorage();
            }

            getMessageClass(type) {
                switch(type) {
                    case 'success': return 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800';
                    case 'warning': return 'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800';
                    case 'danger': return 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800';
                    case 'important': return 'bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800';
                    default: return 'bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600';
                }
            }

            startSupplementNotifications() {
                // Check for supplement reminders every minute
                setInterval(() => {
                    this.checkSupplementReminders();
                }, 60000);

                // Initial check
                this.checkSupplementReminders();
            }

            checkSupplementReminders() {
                if (!this.supplements || this.supplements.length === 0) return;

                const now = new Date();
                const currentTime = now.getHours() * 100 + now.getMinutes();

                // Find next supplement
                let nextSupplement = null;
                let minTimeDiff = Infinity;

                for (const supplement of this.supplements) {
                    const [hours, minutes] = supplement.time.split(':').map(Number);
                    const supplementTime = hours * 100 + minutes;

                    let timeDiff = supplementTime - currentTime;
                    if (timeDiff < 0) {
                        timeDiff += 2400; // Add 24 hours if time has passed
                    }

                    if (timeDiff < minTimeDiff && timeDiff > 0) {
                        minTimeDiff = timeDiff;
                        nextSupplement = supplement;
                    }
                }

                // Find last taken supplement
                let lastSupplement = null;
                let maxTimeDiff = -Infinity;

                for (const supplement of this.supplements) {
                    const [hours, minutes] = supplement.time.split(':').map(Number);
                    const supplementTime = hours * 100 + minutes;

                    let timeDiff = currentTime - supplementTime;
                    if (timeDiff < 0) {
                        timeDiff += 2400; // Add 24 hours if time hasn't come yet
                    }

                    if (timeDiff > maxTimeDiff && timeDiff >= 0) {
                        maxTimeDiff = timeDiff;
                        lastSupplement = supplement;
                    }
                }

                // Show notification for next supplement if within 30 minutes
                if (nextSupplement && minTimeDiff <= 30) {
                    const hours = Math.floor(minTimeDiff / 100);
                    const minutes = minTimeDiff % 100;
                    const timeString = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
                    this.showNotification(`â° ${nextSupplement.name} in ${timeString}`);
                }

                // Show reminder for missed supplements
                if (lastSupplement && maxTimeDiff > 60) { // More than 1 hour ago
                    this.showNotification(`ðŸ’Š Don't forget: ${lastSupplement.name} (${lastSupplement.time})`);
                }
            }

            addSupplement() {
                const nameInput = document.getElementById('supplementName');
                const timeInput = document.getElementById('supplementTime');

                const name = nameInput.value.trim();
                const time = timeInput.value;

                if (!name || !time) {
                    this.showNotification("Please enter both supplement name and time");
                    return;
                }

                this.supplements.push({ name, time });
                this.updateSupplementsList();
                this.saveToLocalStorage();

                // Clear inputs
                nameInput.value = '';
                timeInput.value = '';

                this.showNotification(`Added ${name} at ${time}`);

                // Keep modal open for adding more supplements
                // Don't close the modal here
            }

            updateSupplementsList() {
                const container = document.getElementById('supplementsList');
                container.innerHTML = '';

                this.supplements.forEach((supplement, index) => {
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-1 bg-gray-50 dark:bg-gray-700 rounded text-xs';
                    item.innerHTML = `
                        <span class="dark:text-gray-200">${supplement.name} - ${supplement.time}</span>
                        <button onclick="removeSupplement(${index})" class="text-red-500 hover:text-red-700">Ã—</button>
                    `;
                    container.appendChild(item);
                });
            }

            showNotification(message) {
                const notification = document.getElementById('notification');
                const notificationText = document.getElementById('notificationText');

                notificationText.textContent = message;
                notification.classList.remove('hidden');
                notification.classList.remove('translate-x-full');
                notification.classList.add('translate-x-0');

                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        notification.classList.add('hidden');
                    }, 300);
                }, 3000);
            }
        }

        // Motivational quotes for weight loss
        const motivationalQuotes = [
            "Every small positive change we make in ourselves repays us in confidence in the future.",
            "The only bad workout is the one that didn't happen.",
            "Success is the sum of small efforts, repeated day in and day out.",
            "Your body can do it. It's your mind you have to convince.",
            "The difference between try and triumph is just a little umph!",
            "Don't stop when you're tired. Stop when you're done.",
            "The hardest lift of all is lifting your butt off the couch.",
            "Sweat is just fat crying.",
            "You don't have to be great to start, but you have to start to be great.",
            "The body achieves what the mind believes.",
            "Fitness is not about being better than someone else. It's about being better than you used to be.",
            "Take care of your body. It's the only place you have to live.",
            "The pain you feel today will be the strength you feel tomorrow.",
            "Your health is an investment, not an expense.",
            "Every workout counts, even the ones you don't want to do.",
            "The journey of a thousand miles begins with a single step.",
            "Believe you can and you're halfway there.",
            "The only way to fail is to stop trying.",
            "Small daily improvements lead to stunning results.",
            "Your body hears everything your mind says.",
            "Progress, not perfection.",
            "One workout at a time. One meal at a time. One day at a time.",
            "The best way to predict your future is to create it.",
            "You are stronger than you think.",
            "Every champion was once a contender who refused to give up.",
            "The difference between who you are and who you want to be is what you do.",
            "Success is walking from failure to failure with no loss of enthusiasm.",
            "The only person you should compare yourself to is the person you were yesterday.",
            "Your body is a reflection of your lifestyle.",
            "Health is not valued till sickness comes.",
            "The first wealth is health.",
            "Take care of your body, it's the only place you have to live in.",
            "A healthy outside starts from the inside.",
            "The groundwork for all happiness is good health.",
            "He who has health has hope, and he who has hope has everything.",
            "Health is a state of complete harmony of the body, mind and spirit.",
            "The greatest wealth is health.",
            "A good laugh and a long sleep are the best cures in the doctor's book.",
            "Early to bed and early to rise makes a man healthy, wealthy and wise.",
            "An apple a day keeps the doctor away.",
            "Let food be thy medicine and medicine be thy food.",
            "The body is the garden of the soul.",
            "To keep the body in good health is a duty, otherwise we shall not be able to keep our mind strong and clear.",
            "The best doctor gives the least medicine.",
            "Prevention is better than cure.",
            "A sound mind in a sound body.",
            "Health is not simply the absence of sickness.",
            "The more you praise and celebrate your life, the more there is in life to celebrate.",
            "The way you treat yourself sets the standard for others.",
            "Self-care is giving the world the best of you, instead of what's left of you.",
            "You yourself, as much as anybody in the entire universe, deserve your love and affection.",
            "The better you feel about yourself, the less you feel the need to show off.",
            "To be beautiful means to be yourself. You don't need to be accepted by others. You need to accept yourself."
        ];

        function displayRandomQuote() {
            const quoteElement = document.getElementById('motivationalQuote');
            if (quoteElement) {
                const randomIndex = Math.floor(Math.random() * motivationalQuotes.length);
                quoteElement.textContent = `"${motivationalQuotes[randomIndex]}"`;
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            loadDarkModePreference();
            simulator = new SemiglutideSimulator();
            displayRandomQuote();

            // Initialize Add to Home Screen functionality
            // Only show on mobile devices and when not already installed
            if (window.navigator.standalone !== true &&
                !window.matchMedia('(display-mode: standalone)').matches &&
                (window.innerWidth < 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))) {

                setTimeout(() => {
                    const addToHomeScreen = AddToHomeScreen({
                        appName: "Semiglutide Simulator",
                        appIconUrl: "icon.svg",
                        assetUrl: "https://cdn.jsdelivr.net/npm/add-to-homescreen@1.0.0/dist/assets/",
                        appNameDisplay: "inline",
                        maxModalDisplayCount: 1, // Only show once
                        allowClose: true,
                        showArrow: false, // Disable arrow to avoid positioning issues
                        displayOptions: {
                            showMobile: true,
                            showDesktop: false
                        }
                    });

                    // Only show if not already installed
                    if (!addToHomeScreen.isStandAlone()) {
                        addToHomeScreen.show();
                    }
                }, 5000); // Longer delay
            }
        });
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .dark body {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-gradient:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4298 100%);
        }

        .progress-gradient {
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
        }

        .message-bubble {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 4px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .craving-wave {
            animation: wave 2s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.2); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors">
    <div class="container mx-auto px-2 py-2 max-w-sm">
        <!-- Header with Eat Meal Button -->
        <div class="flex justify-between items-center mb-2">
            <div>
                <h1 class="text-lg font-bold text-gray-800 dark:text-gray-200">Semiglutide Simulator</h1>
                <p class="text-xs text-gray-500 dark:text-gray-400" id="currentDateTime">Loading...</p>
            </div>
            <div class="flex items-center space-x-2">
                <button onclick="eatMeal()" class="bg-gradient-to-r from-red-500 to-red-600 text-white py-1.5 px-3 rounded-lg font-medium text-sm transition-all duration-200 hover:shadow-lg hover:from-red-600 hover:to-red-700">
                    Eat Meal
                </button>
                <button id="darkModeToggle" class="p-1.5 rounded-full bg-white dark:bg-gray-700 shadow-sm hover:shadow-md transition-shadow" onclick="toggleDarkMode()">
                    <svg class="w-4 h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                </button>
                <button class="p-1.5 rounded-full bg-white dark:bg-gray-700 shadow-sm hover:shadow-md transition-shadow" onclick="toggleSettings()">
                    <svg class="w-4 h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen px-4">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 w-full max-w-sm">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Settings</h2>
                        <button onclick="toggleSettings()" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Starting Dose (mg)</label>
                            <input type="number" step="0.25" min="0.25" max="2.0" id="startingDose"
                                   class="w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Current Week</label>
                            <input type="number" min="1" max="24" id="currentWeek"
                                   class="w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Weight Loss Goal (kg)</label>
                            <input type="number" min="1" max="50" id="weightGoal"
                                   class="w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Current Weight Loss (kg)</label>
                            <input type="number" step="0.1" min="0" max="50" id="currentWeightLoss"
                                   class="w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="enableTimeControls" class="mr-2">
                            <label for="enableTimeControls" class="text-xs font-medium text-gray-700 dark:text-gray-300">Enable Time Controls</label>
                        </div>

                        <div>
                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Supplements Schedule</label>
                            <div id="supplementsList" class="space-y-1 max-h-20 overflow-y-auto">
                                <!-- Supplements will be added here -->
                            </div>
                            <div class="flex space-x-1 mt-1">
                                <input type="text" id="supplementName" placeholder="Supplement name" class="flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded">
                                <input type="time" id="supplementTime" class="px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded">
                                <button onclick="addSupplement()" class="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">+</button>
                            </div>
                        </div>

                        <button onclick="saveSettings()" class="w-full btn-gradient text-white py-2 px-3 rounded-md font-medium text-sm transition-all duration-200 hover:shadow-lg">
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Stats Cards -->
        <div class="grid grid-cols-2 gap-2 mb-2">
            <!-- Treatment Progress (replaces Current Week) -->
            <div class="bg-white dark:bg-gray-800 rounded-lg p-2 card-shadow">
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Treatment Progress</div>
                <div class="text-xs text-purple-600 dark:text-purple-400 font-medium mb-1" id="treatmentStatus">Week 1/12</div>
                <div class="grid grid-cols-4 gap-0.5" id="treatmentDots">
                    <!-- Dots will be generated here in 4x3 matrix -->
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-2 card-shadow">
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Weight Progress</div>
                <div class="text-xl font-bold text-green-600 dark:text-green-400" id="weightProgress">-0.0kg</div>
                <div class="text-xs text-gray-400 dark:text-gray-500" id="weightGoalDisplay">0.0kg / 5kg Goal</div>
            </div>
        </div>

        <!-- Vital Stats - Rearranged Layout -->
        <div class="grid grid-cols-3 gap-1 mb-2">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 card-shadow">
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Appetite</div>
                <div class="text-lg font-bold" id="appetiteLevel">Low</div>
                <div class="text-xs text-gray-400 dark:text-gray-500 mt-0.5">GLP-1 Effect</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 card-shadow">
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Energy</div>
                <div class="text-lg font-bold" id="energyLevel">Stable</div>
                <div class="text-xs text-gray-400 dark:text-gray-500 mt-0.5">Metabolic</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 card-shadow">
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Nausea</div>
                <div class="text-lg font-bold" id="nauseaLevel">None</div>
                <div class="text-xs text-gray-400 dark:text-gray-500 mt-0.5">Side Effect</div>
            </div>
        </div>


        <!-- Second Row: Hunger and Cravings -->
        <div class="grid grid-cols-2 gap-1 mb-2">
            <!-- Modern Hunger Visualization -->
            <div class="bg-white dark:bg-gray-800 rounded-lg p-2 card-shadow">
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Hunger Level</div>
                <div id="hungerVisualization" class="flex items-center mb-1">
                    <!-- Hunger segments will be generated here -->
                </div>
                <div class="text-xs font-medium text-gray-700 dark:text-gray-300" id="hungerStatus">Satisfied</div>
            </div>

            <!-- Cravings Card -->
            <div class="bg-white dark:bg-gray-800 rounded-lg p-2 card-shadow relative overflow-hidden">
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Cravings</div>
                <div class="text-lg font-bold" id="cravingsLevel">20%</div>
                <div class="text-xs text-gray-400 dark:text-gray-500">Suppression</div>
                <!-- Emoji background -->
                <div class="absolute top-1 right-1 text-2xl opacity-10 animate-pulse" id="cravingsEmoji">ðŸª</div>
            </div>
        </div>

        <!-- Time Controls with Documentation -->
        <div id="timeControlsSection" class="bg-white dark:bg-gray-800 rounded-lg p-2 card-shadow mb-2" style="display: none;">
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">Time Controls</div>
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">
                <p>Simulate time progression to see how your body responds.</p>
            </div>
            <div class="grid grid-cols-3 gap-1">
                <button onclick="advanceTime(1)" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-1.5 px-2 rounded text-xs font-medium transition-colors">
                    +1 Hour
                </button>
                <button onclick="advanceTime(4)" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-1.5 px-2 rounded text-xs font-medium transition-colors">
                    +4 Hours
                </button>
                <button onclick="advanceTime(24)" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-1.5 px-2 rounded text-xs font-medium transition-colors">
                    +1 Day
                </button>
            </div>
        </div>

        <!-- Thought Chain / Messages -->
        <div class="bg-white dark:bg-gray-800 rounded-lg p-2 card-shadow mb-2">
            <div class="flex justify-between items-center mb-1">
                <h3 class="font-semibold text-gray-800 dark:text-gray-200 text-sm">Thought Chain</h3>
                <button onclick="clearMessages()" class="text-xs text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300">Clear</button>
            </div>
            <div id="messageContainer" class="space-y-1 scrollbar-thin max-h-24 overflow-y-auto">
                <!-- Messages will be added here -->
            </div>
        </div>

        <!-- Meal History -->
        <div class="bg-white dark:bg-gray-800 rounded-lg p-2 card-shadow mb-2">
            <div class="flex justify-between items-center mb-1">
                <h3 class="font-semibold text-gray-800 dark:text-gray-200 text-sm">Meal History</h3>
                <button onclick="clearMealHistory()" class="text-xs text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300">Clear</button>
            </div>
            <div id="mealHistory" class="space-y-1 scrollbar-thin max-h-20 overflow-y-auto">
                <!-- Meal history will be added here -->
            </div>
        </div>

        <!-- Motivational Quote -->
        <div class="text-center py-2">
            <p id="motivationalQuote" class="text-xs italic text-gray-600 dark:text-gray-400 leading-relaxed"></p>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="fixed bottom-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-3 max-w-xs z-50 transform translate-x-full transition-transform duration-300 hidden">
        <div class="flex items-center space-x-2">
            <div class="w-6 h-6 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center">
                <svg class="w-3 h-3 text-purple-600 dark:text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
            </div>
            <div>
                <p class="text-xs text-gray-800 dark:text-gray-200" id="notificationText">Notification message</p>
            </div>
        </div>
    </div>
</body>
</html>